<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Test Login Academia UMBRAMED</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .credentials {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            margin: 20px 0;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover { background: #5a67d8; }
        .input-test {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 200px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Test de Login - Academia UMBRAMED</h1>
        
        <div class="credentials">
            <h3>ÔøΩ Sistema de Autenticaci√≥n Seguro:</h3>
            <ul>
                <li><strong>Administrador:</strong> admin@umbramed.org ‚Üí UmbramedAdmin2025!</li>
                <li><strong>Sistema de Registro:</strong> Crear cuenta nueva disponible</li>
                <li><strong>Perfiles de Usuario:</strong> Estad√≠sticas y logros personalizados</li>
                <li><strong>Seguridad:</strong> Credenciales ya no expuestas p√∫blicamente</li>
            </ul>
        </div>

        <div class="info test-result">
            <strong>üîç Estado del sistema:</strong> <span id="systemStatus">Verificando...</span>
        </div>

        <h3>üß™ Test Manual de Login:</h3>
        <div>
            <input type="text" id="testUser" class="input-test" placeholder="Email" value="admin@umbramed.org">
            <input type="password" id="testPass" class="input-test" placeholder="Contrase√±a" value="UmbramedAdmin2025!">
            <button onclick="testLogin()">üîë Probar Login</button>
        </div>

        <div id="testResults"></div>

        <h3>üöÄ Accesos Directos:</h3>
        <button onclick="openAcademia()">üéì Abrir Academia Normal</button>
        <button onclick="openAcademiaWithCache()">üîÑ Abrir Academia (Anti-cach√©)</button>
        <button onclick="runDiagnostics()">üîß Ejecutar Diagn√≥sticos</button>

        <div id="diagnostics"></div>
    </div>

    <script>
        // Sistema de autenticaci√≥n seguro actualizado
        const users = {
            'admin@umbramed.org': {
                password: 'UmbramedAdmin2025!',
                name: 'Administrador UMBRAMED',
                role: 'admin'
            }
        };

        function updateStatus(message, type = 'info') {
            document.getElementById('systemStatus').innerHTML = message;
        }

        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML += `<div class="test-result ${type}">${message}</div>`;
        }

        function testLogin() {
            const username = document.getElementById('testUser').value;
            const password = document.getElementById('testPass').value;
            
            // Limpiar resultados anteriores
            document.getElementById('testResults').innerHTML = '';
            
            console.log('Probando login con:', username, '/', password);
            
            if (users[username] && users[username].password === password) {
                showResult(`‚úÖ LOGIN EXITOSO: ${username} ‚Üí ${users[username].name}`, 'success');
                showResult(`üìù Rol: ${users[username].role}`, 'info');
                showResult(`üîí Sistema de autenticaci√≥n seguro funcionando`, 'success');
                showResult(`üë§ Perfil de usuario y estad√≠sticas disponibles`, 'success');
            } else {
                showResult(`‚ùå LOGIN FALLIDO: Email "${username}" o contrase√±a incorrectos`, 'error');
                if (users[username]) {
                    showResult(`‚ö†Ô∏è Usuario existe, pero contrase√±a incorrecta`, 'error');
                    showResult(`üîç Contrase√±a esperada: "${users[username].password}"`, 'info');
                } else {
                    showResult(`‚ö†Ô∏è Email "${username}" no registrado`, 'error');
                    showResult(`üí° Usar funci√≥n "Crear cuenta nueva" para registrarse`, 'info');
                }
            }
        }

        function openAcademia() {
            window.open('academia.html', '_blank');
        }

        function openAcademiaWithCache() {
            const timestamp = new Date().getTime();
            window.open(`academia.html?v=${timestamp}`, '_blank');
        }

        function runDiagnostics() {
            const diagnosticsDiv = document.getElementById('diagnostics');
            diagnosticsDiv.innerHTML = '<h3>üîç Diagn√≥sticos del Sistema:</h3>';
            
            // Test 1: Verificar si academia.html existe
            fetch('academia.html')
                .then(response => {
                    if (response.ok) {
                        diagnosticsDiv.innerHTML += '<div class="test-result success">‚úÖ academia.html accesible</div>';
                        return response.text();
                    } else {
                        throw new Error('Archivo no encontrado');
                    }
                })
                .then(html => {
                    // Test 2: Verificar si contiene las credenciales
                    if (html.includes('academia-umbramed.js')) {
                        diagnosticsDiv.innerHTML += '<div class="test-result success">‚úÖ Referencia a academia-umbramed.js encontrada</div>';
                    } else {
                        diagnosticsDiv.innerHTML += '<div class="test-result error">‚ùå No se encuentra referencia al archivo JS</div>';
                    }
                    
                    if (html.includes('demo')) {
                        diagnosticsDiv.innerHTML += '<div class="test-result success">‚úÖ Credenciales demo visibles en HTML</div>';
                    } else {
                        diagnosticsDiv.innerHTML += '<div class="test-result error">‚ùå Credenciales demo no visibles</div>';
                    }
                })
                .catch(error => {
                    diagnosticsDiv.innerHTML += '<div class="test-result error">‚ùå Error accediendo a academia.html: ' + error.message + '</div>';
                });

            // Test 3: Verificar archivo JS
            fetch('js/academia-umbramed.js')
                .then(response => {
                    if (response.ok) {
                        diagnosticsDiv.innerHTML += '<div class="test-result success">‚úÖ js/academia-umbramed.js accesible</div>';
                        return response.text();
                    } else {
                        throw new Error('Archivo JS no encontrado');
                    }
                })
                .then(jsContent => {
                    if (jsContent.includes("'demo'")) {
                        diagnosticsDiv.innerHTML += '<div class="test-result success">‚úÖ Usuario demo encontrado en JS</div>';
                    } else {
                        diagnosticsDiv.innerHTML += '<div class="test-result error">‚ùå Usuario demo NO encontrado en JS</div>';
                    }
                    
                    if (jsContent.includes('password')) {
                        diagnosticsDiv.innerHTML += '<div class="test-result success">‚úÖ Sistema de contrase√±as implementado</div>';
                    }
                })
                .catch(error => {
                    diagnosticsDiv.innerHTML += '<div class="test-result error">‚ùå Error accediendo al archivo JS: ' + error.message + '</div>';
                });
        }

        // Auto-ejecutar diagn√≥sticos al cargar
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('Sistema cargado correctamente ‚úÖ', 'success');
            runDiagnostics();
        });

        // Test autom√°tico con demo/demo despu√©s de 2 segundos
        setTimeout(() => {
            testLogin();
        }, 2000);
    </script>
</body>
</html>
