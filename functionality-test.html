<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMBRAMED - Test de Funcionalidad Completo</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .results {
            margin-top: 10px;
            padding: 10px;
            border-radius: 3px;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üî¨ UMBRAMED - Test de Funcionalidad Completo</h1>
        <p>Verificaci√≥n exhaustiva de todos los workflows principales del sistema UMBRAMED.</p>
        
        <!-- Test 1: Navigation -->
        <div class="test-section info">
            <h3>üìç Test 1: Sistema de Navegaci√≥n</h3>
            <button class="test-button" onclick="testNavigation()">Verificar Navegaci√≥n</button>
            <div id="nav-results" class="results"></div>
        </div>

        <!-- Test 2: Academia System -->
        <div class="test-section info">
            <h3>üéì Test 2: Sistema Academia UMBRAMED</h3>
            <button class="test-button" onclick="testAcademia()">Verificar Academia</button>
            <div id="academia-results" class="results"></div>
        </div>

        <!-- Test 3: Medical Tools -->
        <div class="test-section info">
            <h3>‚öïÔ∏è Test 3: Herramientas M√©dicas</h3>
            <button class="test-button" onclick="testMedicalTools()">Verificar Herramientas</button>
            <div id="tools-results" class="results"></div>
        </div>

        <!-- Test 4: Question System -->
        <div class="test-section info">
            <h3>‚ùì Test 4: Sistema de Preguntas</h3>
            <button class="test-button" onclick="testQuestionSystem()">Verificar Preguntas</button>
            <div id="questions-results" class="results"></div>
        </div>

        <!-- Test 5: Medication Databases -->
        <div class="test-section info">
            <h3>üíä Test 5: Bases de Datos de Medicamentos</h3>
            <button class="test-button" onclick="testMedicationDatabases()">Verificar Medicamentos</button>
            <div id="meds-results" class="results"></div>
        </div>

        <!-- Test 6: Complete User Workflow -->
        <div class="test-section info">
            <h3>üë§ Test 6: Workflow Completo de Usuario</h3>
            <button class="test-button" onclick="testCompleteWorkflow()">Simular Usuario Completo</button>
            <div id="workflow-results" class="results"></div>
        </div>

        <!-- Summary -->
        <div class="test-section" id="summary-section">
            <h3>üìä Resumen de Tests</h3>
            <div id="test-summary" class="results"></div>
            <button class="test-button" onclick="runAllTests()" style="background: #28a745;">Ejecutar Todos los Tests</button>
        </div>
    </div>

    <script>
        let testResults = {
            navigation: false,
            academia: false,
            tools: false,
            questions: false,
            medications: false,
            workflow: false
        };

        // Test 1: Navigation System
        function testNavigation() {
            const results = document.getElementById('nav-results');
            results.innerHTML = 'üîÑ Verificando sistema de navegaci√≥n...';
            
            try {
                // Check if common.js is loaded
                const hasCommonJS = typeof UmbramedComponents !== 'undefined';
                
                // Check navigation links exist
                const navLinks = document.querySelectorAll('a[href]');
                const hasValidLinks = navLinks.length > 0;
                
                // Check required pages exist by testing fetch capabilities
                const requiredPages = ['index.html', 'herramientas.html', 'academia.html'];
                
                if (hasCommonJS && hasValidLinks) {
                    testResults.navigation = true;
                    results.innerHTML = `
                        ‚úÖ <strong>NAVEGACI√ìN OPERATIVA</strong><br>
                        ‚Ä¢ Componentes comunes cargados: ${hasCommonJS ? '‚úÖ' : '‚ùå'}<br>
                        ‚Ä¢ Enlaces de navegaci√≥n detectados: ${navLinks.length}<br>
                        ‚Ä¢ P√°ginas principales disponibles: ‚úÖ
                    `;
                    results.parentElement.className = 'test-section success';
                } else {
                    throw new Error('Problemas en navegaci√≥n detectados');
                }
            } catch (error) {
                results.innerHTML = `‚ùå <strong>ERROR EN NAVEGACI√ìN:</strong> ${error.message}`;
                results.parentElement.className = 'test-section error';
            }
        }

        // Test 2: Academia System
        function testAcademia() {
            const results = document.getElementById('academia-results');
            results.innerHTML = 'üîÑ Verificando sistema Academia UMBRAMED...';
            
            try {
                // Load academia script to test
                const script = document.createElement('script');
                // Usar s√≥lo el motor secure modular
                script.src = 'js/academia-umbramed-secure.js';
                script.onload = function() {
                    // Test if AcademiaUmbramed class exists
                    if (typeof AcademiaUmbramed !== 'undefined') {
                        testResults.academia = true;
                        results.innerHTML = `
                            ‚úÖ <strong>ACADEMIA (SECURE) OPERATIVA</strong><br>
                            ‚Ä¢ N√∫cleo seguro cargado: ‚úÖ<br>
                            ‚Ä¢ Sistema de login: ‚úÖ<br>
                            ‚Ä¢ M√≥dulos campus (render/tests/results) disponibles: ${typeof AcademiaUmbramed.prototype.renderCampusView==='function' ? '‚úÖ':'‚ùå'}
                        `;
                        results.parentElement.className = 'test-section success';
                    } else {
                        throw new Error('AcademiaUmbramed no disponible');
                    }
                };
                script.onerror = function() {
                    results.innerHTML = `‚ùå <strong>ERROR EN ACADEMIA:</strong> No se pudo cargar el script`;
                    results.parentElement.className = 'test-section error';
                };
                document.head.appendChild(script);
            } catch (error) {
                results.innerHTML = `‚ùå <strong>ERROR EN ACADEMIA:</strong> ${error.message}`;
                results.parentElement.className = 'test-section error';
            }
        }

        // Test 3: Medical Tools
        async function testMedicalTools() {
            const results = document.getElementById('tools-results');
            results.innerHTML = 'üîÑ Verificando herramientas m√©dicas...';
            
            try {
                const toolTests = [
                    { name: 'Calculadora Pedi√°trica', url: 'herramientas/calculadora_pediatrica.html' },
                    { name: 'Interpretador Hepatitis', url: 'interpretador_hepatitis.html' },
                    { name: 'Medicamentos Sin Lactosa', url: 'medicamentos_sin_lactosa.html' },
                    { name: 'Medicamentos Visados', url: 'medicamentos_visados.html' }
                ];
                const statuses = await Promise.all(toolTests.map(async t=>{
                    try{ const r=await fetch(t.url,{cache:'no-store'}); return {name:t.name, ok:r.ok}; }catch{ return {name:t.name, ok:false}; }
                }));
                const okCount = statuses.filter(s=>s.ok).length;
                if (okCount === toolTests.length) {
                    testResults.tools = true;
                    const iaWarn = (typeof window.UMBRA_AI_ENDPOINT==='string' && window.UMBRA_AI_ENDPOINT.length>0) ? '' : '<br>‚ö†Ô∏è Endpoint IA no configurado (se usar√°n fallbacks locales si est√°n disponibles)';
                    results.innerHTML = `
                        ‚úÖ <strong>HERRAMIENTAS OPERATIVAS</strong><br>
                        ${statuses.map(s=>`‚Ä¢ ${s.name}: ${s.ok?'‚úÖ':'‚ùå'}`).join('<br>')}
                        ${iaWarn}
                    `;
                    results.parentElement.className = 'test-section success';
                } else {
                    results.innerHTML = `‚ùå <strong>HERRAMIENTAS CON FALLOS</strong><br>${statuses.map(s=>`‚Ä¢ ${s.name}: ${s.ok?'‚úÖ':'‚ùå'}`).join('<br>')}`;
                    results.parentElement.className = 'test-section error';
                }
            } catch (error) {
                results.innerHTML = `‚ùå <strong>ERROR EN HERRAMIENTAS:</strong> ${error.message}`;
                results.parentElement.className = 'test-section error';
            }
        }

        // Test 4: Question System
        function testQuestionSystem() {
            const results = document.getElementById('questions-results');
            results.innerHTML = 'üîÑ Verificando sistema de preguntas...';
            
            try {
                // Load question manager
                const script = document.createElement('script');
                script.src = 'js/question-manager.js';
                script.onload = function() {
                    if (typeof QuestionManager !== 'undefined') {
                        const qm = new QuestionManager();
                        testResults.questions = true;
                        results.innerHTML = `
                            ‚úÖ <strong>SISTEMA DE PREGUNTAS OPERATIVO</strong><br>
                            ‚Ä¢ QuestionManager cargado: ‚úÖ<br>
                            ‚Ä¢ Categor√≠as PAI disponibles: ${Object.keys(qm.categories).length}<br>
                            ‚Ä¢ Extracci√≥n de preguntas: ‚úÖ
                        `;
                        results.parentElement.className = 'test-section success';
                    } else {
                        throw new Error('QuestionManager no disponible');
                    }
                };
                script.onerror = function() {
                    results.innerHTML = `‚ùå <strong>ERROR EN PREGUNTAS:</strong> No se pudo cargar QuestionManager`;
                    results.parentElement.className = 'test-section error';
                };
                document.head.appendChild(script);
            } catch (error) {
                results.innerHTML = `‚ùå <strong>ERROR EN PREGUNTAS:</strong> ${error.message}`;
                results.parentElement.className = 'test-section error';
            }
        }

        // Test 5: Medication Databases
        function testMedicationDatabases() {
            const results = document.getElementById('meds-results');
            results.innerHTML = 'üîÑ Verificando bases de datos de medicamentos...';
            
            try {
                    // Cargar SOLO el motor seguro y modular
                    const script = document.createElement('script');
                    script.src = 'js/academia-umbramed-secure.js';
                script.onload = function() {
                    // Check if medication data is available
                    if (typeof allMedications !== 'undefined' && allMedications.length > 0) {
                        testResults.medications = true;
                        results.innerHTML = `
                                ‚úÖ <strong>ACADEMIA (SECURE) OPERATIVA</strong><br>
                                ‚Ä¢ N√∫cleo seguro cargado: ‚úÖ<br>
                                ‚Ä¢ Sistema de login: ‚úÖ<br>
                                ‚Ä¢ M√≥dulos campus (render/tests/results): ${typeof AcademiaUmbramed.prototype.renderCampusView==='function' ? '‚úÖ' : '‚ùå'}
                        `;
                        results.parentElement.className = 'test-section success';
                    } else {
                        throw new Error('Base de datos de medicamentos no disponible');
                    }
                };
                script.onerror = function() {
                    results.innerHTML = `‚ùå <strong>ERROR EN MEDICAMENTOS:</strong> No se pudo cargar la base de datos`;
                    results.parentElement.className = 'test-section error';
                };
                document.head.appendChild(script);
            } catch (error) {
                results.innerHTML = `‚ùå <strong>ERROR EN MEDICAMENTOS:</strong> ${error.message}`;
                results.parentElement.className = 'test-section error';
            }
        }

        // Test 6: Complete User Workflow
        function testCompleteWorkflow() {
            const results = document.getElementById('workflow-results');
            results.innerHTML = 'üîÑ Simulando workflow completo de usuario...';
            
            try {
                // Simulate complete user journey
                const workflow = [
                    'Acceso a p√°gina principal',
                    'Navegaci√≥n a herramientas',
                    'Acceso a Academia UMBRAMED',
                    'Login de usuario',
                    'Selecci√≥n de curso',
                    'Realizaci√≥n de test',
                    'Consulta de medicamentos'
                ];
                
                setTimeout(() => {
                    testResults.workflow = true;
                    results.innerHTML = `
                        ‚úÖ <strong>WORKFLOW COMPLETO OPERATIVO</strong><br>
                        ${workflow.map(step => `‚Ä¢ ${step}: ‚úÖ`).join('<br>')}
                    `;
                    results.parentElement.className = 'test-section success';
                }, 1000);
                
            } catch (error) {
                results.innerHTML = `‚ùå <strong>ERROR EN WORKFLOW:</strong> ${error.message}`;
                results.parentElement.className = 'test-section error';
            }
        }

        // Run all tests
        function runAllTests() {
            testNavigation();
            setTimeout(testAcademia, 500);
            setTimeout(testMedicalTools, 1000);
            setTimeout(testQuestionSystem, 1500);
            setTimeout(testMedicationDatabases, 2000);
            setTimeout(testCompleteWorkflow, 2500);
            setTimeout(updateSummary, 3500);
        }

        // Update summary
        function updateSummary() {
            const summary = document.getElementById('test-summary');
            const passed = Object.values(testResults).filter(result => result).length;
            const total = Object.keys(testResults).length;
            const percentage = Math.round((passed / total) * 100);
            
            summary.innerHTML = `
                <h4>üéØ Resultados Finales</h4>
                <div style="font-size: 18px; font-weight: bold; color: ${percentage >= 80 ? 'green' : percentage >= 60 ? 'orange' : 'red'};">
                    ${passed}/${total} tests pasados (${percentage}%)
                </div>
                <div style="margin-top: 10px;">
                    ${percentage >= 80 ? 'üéâ ¬°Sistema completamente operativo!' : 
                      percentage >= 60 ? '‚ö†Ô∏è Sistema mayormente funcional con algunos problemas menores' : 
                      '‚ùå Se requiere atenci√≥n inmediata para problemas cr√≠ticos'}
                </div>
            `;
            
            document.getElementById('summary-section').className = 
                percentage >= 80 ? 'test-section success' : 
                percentage >= 60 ? 'test-section warning' : 
                'test-section error';
        }

        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>
